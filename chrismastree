<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Christmas Tree</title>
<style>
  body{
    margin:0; min-height:100vh;
    display:flex; align-items:center; justify-content:center;
    background:#0b1020;
    font-family: Consolas, ui-monospace, SFMono-Regular, Menlo, Monaco, "Liberation Mono", monospace;
  }
  .console{
    background:#000;
    padding:18px 22px;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.45);
    width:min(900px,94vw);
  }
  pre{
    margin:0;
    font-size:16px;
    line-height:1.15;
    white-space:pre;
    user-select:none;
  }

  .cell{
    display:inline-block;
    width:2.5ch;          /* 中文+星星都好看 */
    text-align:center;
  }

  .topstar{ color:#ffd54a; }

  .r{ color:#ff4d4d; }
  .b{ color:#4da3ff; }
  .y{ color:#ffd54a; }
  .w{ color:#ffffff; }
  .g{ color:#22c55e; }
  .p{ color:#a855f7; }
  .c{ color:#22d3ee; }
  .o{ color:#fb923c; }

  .dim{ opacity:.45; }
  .bright{ opacity:1; }

  .trunk{ color:#c08457; }
  .msg{ color:#e5e7eb; }
</style>
</head>
<body>
<div class="console"><pre id="out"></pre></div>

<script>
const out = document.getElementById("out");

/* ===== 参数 ===== */
const H = 14;
const rowSpeed = 70;
const blinkSpeed = 220;
const SEED = 20251225;
const GAP = 2;

/* ===== 画布 ===== */
const W = H * 2 + 15;
const C = Math.floor(W / 2);
const rows = H + 12;

const blank = `<span class="cell">&nbsp;</span>`;
let grid = Array.from({length: rows}, () =>
  Array.from({length: W}, () => blank)
);

/* 固定随机 */
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
const rnd = mulberry32(SEED);

const colors = ["r","b","y","w","g","p","c","o"];
const pickFixedColor = () => colors[Math.floor(rnd()*colors.length)];
const pickBlinkColor = () => colors[Math.floor(Math.random()*colors.length)];

const stars = [];

function put(x,y,html){
  if (y<0||y>=rows||x<0||x>=W) return;
  grid[y][x] = html;
}
function render(){
  out.innerHTML = grid.map(r=>r.join("")).join("\n");
}

/* 顶部星 */
put(C, 0, `<span class="cell topstar">★</span>`);

/* === 生成有间隔的树 === */
const layers = [];
for (let i=0;i<H;i++){
  const y = i+1;
  const left = C-i;
  const right = C+i;

  const row = [];
  let step = 0;
  for (let x=left; x<=right; x++){
    if (step % GAP === 0){
      row.push({x,y,cls: pickFixedColor()});
    }
    step++;
  }
  layers.push(row);
}

/* 逐行长出来 */
let idx = 0;
const grow = setInterval(()=>{
  if (idx >= layers.length){
    clearInterval(grow);

    /* 树干 */
    const ty = H + 1;
    [
      [C-1,ty],[C,ty],
      [C-1,ty+1],[C,ty+1],
      [C-1,ty+2],[C,ty+2],
    ].forEach(([x,y])=>{
      put(x,y, `<span class="cell trunk">█</span>`);
    });

    /* 第一行英文 */
    const msg1 = "Merry  Christmas!";
    const sx1 = C - Math.floor(msg1.length/2);
    const y1 = ty + 4;
    for (let i=0;i<msg1.length;i++){
      const ch = msg1[i]===" " ? "&nbsp;" : msg1[i];
      put(sx1+i, y1, `<span class="cell msg">${ch}</span>`);
    }

    render();

    /* 第二行中文：打字动画 */
    const msg2 = "祝你圣诞快乐小柔希望你看到这棵树会开心";
    const sx2 = C - Math.floor(msg2.length/2);
    const y2 = y1 + 2;

    let charIndex = 0;
    const typer = setInterval(()=>{
      if (charIndex >= msg2.length){
        clearInterval(typer);
        return;
      }
      const ch = msg2[charIndex];
      put(sx2 + charIndex, y2, `<span class="cell msg">${ch}</span>`);
      render();
      charIndex++;
    }, 180);

    /* 星星闪烁 */
    setInterval(()=>{
      for (const s of stars){
        s.cls = pickBlinkColor();
        const glow = Math.random()<0.5 ? "bright" : "dim";
        put(s.x, s.y, `<span class="cell ${s.cls} ${glow}">★</span>`);
      }
      render();
    }, blinkSpeed);

    return;
  }

  for (const p of layers[idx]){
    stars.push(p);
    put(p.x, p.y, `<span class="cell ${p.cls} bright">★</span>`);
  }

  idx++;
  render();
}, rowSpeed);

render();
</script>
</body>
</html>
